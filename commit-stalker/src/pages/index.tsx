import Head from 'next/head'
import { Inter } from '@next/font/google'
import { Readme } from '../components/organisms/readme'
import { SearchForm } from '../components/organisms/search-form'
import { Commits } from '../components/organisms/commits'
import { SearchQueryParams, useSearchQuery } from '../hooks/github-api'
import { useState } from 'react'
import { Commits as CommitsModel } from '../models/commits'
import type { Commits as CommitsType } from '../models/commits'

const inter = Inter({ subsets: ['latin'] })

export default function Home() {
  let commits: CommitsType = []
  const [query, setQuery] = useState<SearchQueryParams>({ owner: '', repository: '' })
  const { isLoading, data, error, isError } = useSearchQuery(query)

  const fetchCommits = (query: SearchQueryParams) => {
    setQuery(query)
  }

  if (isLoading) { console.log('loading...') }
  if (error) { console.error(error) }
  if (data) { commits = CommitsModel.parse(data) }

  return (
    <>
      <Head>
        <title>Commit Stalker</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main>
        <h1>Commit Stalker Title</h1>
        <SearchForm handleSubmit={fetchCommits} />
        <Commits commits={commits} />
        <Readme />
      </main>
    </>
  )
}
